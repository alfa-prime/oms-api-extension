# Структура проекта

## Корневой уровень
- **Конфигурация**: `.env`, `.env.example`, `.prod.env` - Конфигурации окружения
- **Docker**: `Dockerfile`, `Dockerfile.prod`, `docker-compose.yml`, `docker-compose.prod.yml`
- **Сборка**: `makefile` - Общие команды разработки
- **Зависимости**: `requirements.txt` - Зависимости Python пакетов

## Бэкенд (`app/`)
```
app/
├── main.py              # Точка входа FastAPI приложения с управлением жизненным циклом
├── core/                # Основные компоненты приложения
│   ├── config.py        # Настройки и конфигурация Pydantic
│   ├── dependencies.py  # Внедрение зависимостей FastAPI
│   ├── decorators.py    # Пользовательские декораторы
│   ├── httpx_client.py  # Настройка HTTP клиента
│   ├── lifespan_services.py # Управление жизненным циклом приложения
│   └── logger_setup.py  # Конфигурация логирования
├── route/               # Определения API маршрутов
├── service/             # Сервисы бизнес-логики
│   ├── cookie/          # Управление cookies
│   ├── evmias/          # Интеграция с ЕВМИАС
│   └── extension/       # Обработчики API браузерного расширения
├── mapper/              # Преобразование и маппинг данных
│   ├── bed_profiles.py  # Маппинг профилей коек
│   ├── department_codes.py # Маппинг кодов отделений
│   ├── medical_orgs.py  # Маппинг медицинских организаций
│   └── payment_types.py # Маппинг типов оплаты
└── model/               # Модели данных и схемы
    └── extension.py     # Модели специфичные для расширения
```

## Фронтенд (`browser-extension/`)
```
browser-extension/
├── manifest.json        # Конфигурация Chrome расширения
├── index.html          # Интерфейс popup расширения
├── js/
│   ├── apiService.js   # Слой коммуникации с API
│   ├── background.js   # Service worker (фоновый скрипт)
│   ├── content.js      # Content скрипт для взаимодействия со страницей
│   ├── main.js         # Основная логика расширения
│   ├── form.js         # Утилиты манипуляции формами
│   ├── searchLogic.js  # Функциональность поиска пациентов
│   ├── ui.js           # Компоненты пользовательского интерфейса
│   ├── utils.js        # Вспомогательные функции
│   └── pageInjector.js # Логика инъекции в страницу
└── css/
    └── style.css       # Стили расширения
```

## Архитектурные паттерны

### Паттерны бэкенда
- **Слоистая архитектура**: Маршруты → Сервисы → Мапперы → Внешние API
- **Внедрение зависимостей**: Система зависимостей FastAPI для общих ресурсов
- **Async/Await**: Повсеместно для неблокирующих операций
- **Управление конфигурацией**: Централизованные настройки с переменными окружения
- **Управление жизненным циклом**: Правильная инициализация и очистка ресурсов

### Паттерны фронтенда
- **Модульный паттерн**: ES6 модули для организации кода
- **Сервисный слой**: Централизованная коммуникация с API в `apiService.js`
- **Архитектура Content Script**: Разделение взаимодействия со страницей и фоновой обработки
- **Событийно-ориентированная**: Передача сообщений между компонентами расширения

### Поток данных
1. **Расширение** → API Service → **Маршруты бэкенда**
2. **Бэкенд** → Сервис ЕВМИАС → Внешний API
3. **Мапперы** преобразуют данные между системами
4. **Redis** кэширует данные сессий и ответы

## Соглашения по именованию
- **Python**: snake_case для функций, переменных, файлов
- **JavaScript**: camelCase для функций, переменных
- **Файлы**: Описательные имена, отражающие функциональность
- **API эндпоинты**: RESTful паттерны с четким именованием ресурсов
- **Переменные окружения**: ЗАГЛАВНЫЕ с подчеркиваниями